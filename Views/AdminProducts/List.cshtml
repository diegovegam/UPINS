@model UPINS.Models.ViewModels.AddProductRequest
@{

    int nextPage = Convert.ToInt32(ViewBag.PageNumber) + 1;
    int prevPage = Convert.ToInt32(ViewBag.PageNumber) - 1;

}

<form method="get" asp-controller="AdminProducts" asp-action="List">
    <div class="container mt-5">
        <div class="row">
            <div class="col col-md-3 d-flex">
                <input type="text" class="form-control" name="searchQuery" value="@ViewBag.SearchQuery"></input>
                <button type="submit" class="btn btn-secondary ms-3">Buscar</button>
            </div>
        </div>
    </div>
</form>
<div class="container py-5">

    <table class="table">
        <thead>
            <tr>
                <th scope="col">Código</th>
                <th scope="col">Imagen</th>
                <th scope="col">
                    Nombre
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Name" asp-route-sortDirection="Asc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-up"></i>
                            </a>
                        </span>
                    </span>
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Name" asp-route-sortDirection="Desc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-down"></i>
                            </a>
                        </span>
                    </span>
                    </th>
                <th scope="col">
                    Precio
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Price" asp-route-sortDirection="Asc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-up"></i>
                            </a>
                        </span>
                    </span>
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Price" asp-route-sortDirection="Desc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-down"></i>
                            </a>
                        </span>
                    </span>
                    </th>
                <th scope="col">
                    Cantidad
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Quantity" asp-route-sortDirection="Asc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-up"></i>
                            </a>
                        </span>
                    </span>
                    <span>
                        <span>
                            <a class="btn btn-light" asp-controller="AdminProducts" asp-action="List" asp-route-sortBy="Quantity" asp-route-sortDirection="Desc"
                               asp-route-searchQuery="@ViewBag.SearchQuery" asp-route-pageNumber="@ViewBag.PageNumber">
                                <i class="bi bi-arrow-down"></i>
                            </a>
                        </span>
                    </span>
                    </th>



            </tr>
        </thead>
        <tbody class="table-group-divider">
			@foreach (var product in Model.Products)
			{
				<tr>
					<td>@product.code</td>
                    <td><img src="@product.ImageUrl" class="mt-3" id="ImageDisplayList" style="display:block;width: 300px"></td>
					<td>@product.Name</td>
					<td>@product.Price</td>
					<td>@product.Quantity</td>
                    <td>
                        <a class="btn btn-warning" asp-area="" asp-controller="AdminProducts" asp-action="Edit" asp-route-Id="@product.Id">
                            Editar
                        </a>
     
                    </td>
                    <td>
                        <form method="post">
                        <button class="btn btn-danger" type="submit" asp-area="" asp-controller="AdminProducts" asp-action="Delete" asp-route-Id="@product.Id">
                            Eliminar
                        </button>
                        </form>
                    </td>
				</tr>
			}
        </tbody>
    </table>
</div>

<nav aria-label="Page navigation example">
    <ul class="pagination">
        <li class="page-item">
            <a class="page-link" asp-controller="AdminProducts" asp-action="List"
               asp-route-pageNumber="@prevPage" asp-route-sortBy="@ViewBag.sortBy" asp-route-sortDirection="@ViewBag.sortDirection" asp-route-searchQuery="@ViewBag.SearchQuery">Anterior</a>
        </li>
        @for (int i = 1; i <= ViewBag.TotalPages; i++)
        {
            <li class="page-item">
                <a class="page-link" asp-controller="AdminProducts" asp-action="List"
                   asp-route-pageNumber="@i" asp-route-sortBy="@ViewBag.sortBy" asp-route-sortDirection="@ViewBag.sortDirection" asp-route-searchQuery="@ViewBag.SearchQuery">@i</a>
            </li>
        }

        <li class="page-item">
            <a class="page-link" asp-controller="AdminProducts" asp-action="List"
               asp-route-pageNumber="@nextPage" asp-route-sortBy="@ViewBag.sortBy" asp-route-sortDirection="@ViewBag.sortDirection" asp-route-searchQuery="@ViewBag.SearchQuery">Siguiente</a>
        </li>
    </ul>
</nav>

<!-- Button trigger modal -->
<div class="mt-0">
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#AddProductModal">
        Agregar producto
    </button>
</div>


<form method="post">
    <div class="modal fade" id="AddProductModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="name" asp-for="Name" required></input>
                            <span class="text-danger" asp-validation-for="Name"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Precio</label>
                            <input type="number" class="form-control" id="price" asp-for="Price" required minlength="3"></input>
                            <span class="text-danger" asp-validation-for="Price"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Cantidad</label>
                            <input type="number" class="form-control" id="quantity" asp-for="Quantity" required ></input>
                            <span class="text-danger" asp-validation-for="Quantity"></span>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Código</label>
                            <input type="number" class="form-control" id="code" asp-for="Code" required></input>
                            <span class="text-danger" asp-validation-for="Code"></span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Subir Imagen</label>
                            <input type="file" id="ImageUpload" class="form-control"></input>

                            <img src="" class="mt-3 img-fluid" id="ImageDisplay" style="display:block;width: 50px" />
                            <input type="hidden" class="form-control" id="ImageURL" asp-for="ImageUrl" value="\Images\Products"></input>
                        </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="Submit" class="btn btn-primary" asp-area="" asp-controller="AdminProducts" asp-action="Add">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    </div>
</form>

@section Scripts
{
    <script>

        const inputImageUpload = document.getElementById('ImageUpload');
        const inputImageUrl = document.getElementById('ImageURL');
        const inputImageDisplay = document.getElementById('ImageDisplay');

        console.log(inputImageUpload.textContent)
        console.log(inputImageUrl.value)

            inputImageUpload.addEventListener('change', function() {
            const file = this.files[0]; // Get the first selected file
            if (file) {
                let fileName = file.name;
                let pathToTheFile = inputImageUrl.value += "\\" + fileName;
                inputImageDisplay.src = pathToTheFile;
                console.log(inputImageDisplay.src)
            }
        });


    </script>
                

    
}

